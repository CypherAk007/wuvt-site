{% extends "admin/base.html" %}
{% block title %}{{ trackman_name }} - {{ super() }}{% endblock %}
{% block header %}{% endblock %}
{% block content %}

<h1>{{ trackman_name }}: {{ djset.dj.airname }}</h1>

{% if tracks %}
<table class='table table-condensed table-striped table-hover'>
    <thead>
        <tr>
            <th>Artist</th>
            <th>Title</th>
            <th>Album</th>
            <th>Label</th>
            <th></th>
            <th></th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {% for track in tracks %}
        <tr id="track-{{ track.id }}">
            <td>{{ track.artist }}</td>
            <td>{{ track.title }}</td>
            <td>{{ track.album }}</td>
            <td>{{ track.label }}</td>
            <td>{% if track.request %}REQ{% endif %}</td>
            <td>{% if track.vinyl %}VIN{% endif %}</td>
            <td class="buttons">
                <a href="{{ url_for('trackman_edit', setid=djset.id,
                    trackid=track.id) }}" class="btn btn-small">Edit</a>
                <button class="btn btn-small btn-danger delete-track"
                    type="button">Delete</button>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endif %}

<form action="{{ url_for('trackman_log', setid=djset.id) }}" method="post"
    class="form-horizontal">
    <h2>Add to Playlist</h2>

    <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}" />

    <div class="trackman-entry">
        <div class="trackman-controls">
            <div class="control-group">
                <label for="id_artist" class="control-label">Artist</label>
                <div class="controls">
                    <input type="text" name="artist" id="id_artist" value=""
                        required="required" />
                </div>
            </div>

            <div class="control-group">
                <label for="id_title" class="control-label">Title</label>
                <div class="controls">
                    <input type="text" name="title" id="id_title" value=""
                        required="required" />
                </div>
            </div>

            <div class="control-group">
                <label for="id_album" class="control-label">Album</label>
                <div class="controls">
                    <input type="text" name="album" id="id_album" value=""
                        required="required" />
                </div>
            </div>

            <div class="control-group">
                <label for="id_label" class="control-label">Label</label>
                <div class="controls">
                    <input type="text" name="label" id="id_label" value=""
                        required="required" />
                </div>
            </div>

            <div class="control-group">
                <div class="controls">
                    <label class="checkbox">
                        <input type="checkbox" name="request" />
                        Request
                    </label>

                    <label class="checkbox">
                        <input type="checkbox" name="vinyl" />
                        Vinyl
                    </label>
                </div>
            </div>
        </div>

        <div class="trackman-help">
            <i class="icon-flag"></i>
            <h4>If you can't fill in the blanks, you can't play it.</h4>

            You may find these sites helpful to find missing information:
            <ul>
                <li><a href="http://www.allmusic.com/"
                    rel="external">AllMusic</a></li>
                <li><a href="http://www.amazon.com/music/"
                    rel="external">Amazon.com Music</a></li>
                <li><a href="http://www.discogs.com/"
                    rel="external">Discogs</a></li>
                <li><a href="http://musicbrainz.org/search.html"
                    rel="external">MusicBrainz</a></li>
            </ul>
        </div>
    </div>

    <div class="form-actions">
        <button type="submit" class="btn btn-primary">
            <i class="icon-list icon-white"></i>
            Add to Playlist
        </button>

        <button type="button" class="btn" id="trackman_logout_btn">
            <i class="icon-eject"></i>
            Logout
        </button>
    </div>
</form>
<form action="{{ url_for('trackman_logout', setid=djset.id) }}" method="post"
    id="trackman_logout_form">
    <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}" />
</form>
{% endblock %}
{% block js %}
{{ super() }}
<script>
var csrf_token = "{{ csrf_token() }}";

$(function() {
    $('#trackman_logout_btn').click(function() {
        $('#trackman_logout_form').submit();
    });

    $('button.delete-track').bind('click', function(ev) {
        if(confirm("Are you sure you want to delete this track?")) {
            $.ajax({
                'type': "DELETE",
                'url': "/trackman/log/{{ djset.id }}/" +
                    $(this).closest('tr').attr('id').replace("track-", "") +
                    "?_csrf_token=" + csrf_token,
            }).done(function(msg) {
                csrf_token = msg['_csrf_token'];
                $(ev.currentTarget).closest('tr').
                    fadeTo('fast', 0, function() {
                        $(this).remove();
                    });
            });
        }
    });
});
</script>
{% endblock %}
